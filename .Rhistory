stsetwd("C:\\Users\\David\\Dropbox\\Stanford-IM\\Epic Research\\AccessLog2\\Paging Data Analysis")
setwd("P:\PagingDataAnalysis-master")
dir()
#install.packages(c("Rcpp"))
library(ggplot2)
library(plyr)
library(reshape2)
#library(strptime)
library(stringr)
library(scales)
library(ggthemes)
data <- read.csv("Figure1Data-V2-MeltOccupation-Cardiology.csv", stringsAsFactors = TRUE)
data <- data[data$Total.Count >= 50,]
str(data)
HighValues <- data[data$NewRatio>100,]
LowValues <- data[data$NewRatio<0.01,]
data <- data[data$RatioForSort>0.01 ,]
ssetwd("P:\\PagingDataAnalysis-master")
dir()
#install.packages(c("Rcpp"))
library(ggplot2)
library(plyr)
#library(reshape2)
#library(strptime)
library(stringr)
library(scales)
library(ggthemes)
data <- read.csv("Figure1Data-V2-MeltOccupation-Cardiology.csv", stringsAsFactors = TRUE)
data <- data[data$Total.Count >= 50,]
str(data)
HighValues <- data[data$NewRatio>100,]
LowValues <- data[data$NewRatio<0.01,]
data <- data[data$RatioForSort>0.01 ,]
setwd("P:\\PagingDataAnalysis-master")
dir()
data <- read.csv("Figure1Data-V2-MeltOccupation-Cardiology.csv", stringsAsFactors = TRUE)
data <- data[data$Total.Count >= 50,]
str(data)
HighValues <- data[data$NewRatio>100,]
LowValues <- data[data$NewRatio<0.01,]
data <- data[data$RatioForSort>0.01 ,]
date <- as.POSIXct(data$ApprovalDate)
as.POSIXct(strptime(data$ApprovalDate, "%m/%d/%Y"))
date <- as.POSIXct(strptime(data$ApprovalDate, "%m/%d/%Y"))
centerFigure <- ggplot(data, aes(NewRatio, reorder(Generic.Name, -1*RatioForSort), shape = Type, color = OnPatent)) + 
geom_point(alpha = 0.99, size = 4) + scale_shape_manual( values=c(78, 16, 80)) +
geom_rug(data = HighValues, aes(NewRatio), sides = 'r', size = 1.2) + 
geom_errorbarh(aes(xmin = Ratio.lowerbound, xmax = Ratio.upperbound, height = 0)) +
scale_x_log10(limits = c(0.01, 105), breaks = c(0.01, 0.1, 1, 10, 100), labels = c("0.01", "0.1", "1", "10", "100")) + theme_fivethirtyeight() +
theme(axis.text.y = element_text(hjust = .5)) + scale_color_manual("black", "red")
centerFigure
data <- data[data$RatioForSort>0.01 ,]
date <- as.POSIXct(strptime(data$ApprovalDate, "%m/%d/%Y"))
data$OnPatent <- as.factor(data$OnPatent)
# All and without Color
centerFigure <- ggplot(data, aes(NewRatio, reorder(Generic.Name, -1*RatioForSort), shape = Type, color = OnPatent)) + 
geom_point(alpha = 0.99, size = 4) + scale_shape_manual( values=c(78, 16, 80)) +
geom_rug(data = HighValues, aes(NewRatio), sides = 'r', size = 1.2) + 
geom_errorbarh(aes(xmin = Ratio.lowerbound, xmax = Ratio.upperbound, height = 0)) +
scale_x_log10(limits = c(0.01, 105), breaks = c(0.01, 0.1, 1, 10, 100), labels = c("0.01", "0.1", "1", "10", "100")) + theme_fivethirtyeight() +
theme(axis.text.y = element_text(hjust = .5)) + scale_color_manual("black", "red")
centerFigure
centerFigure <- ggplot(data, aes(NewRatio, reorder(Generic.Name, -1*RatioForSort), shape = Type, color = OnPatent)) + 
geom_point(alpha = 0.99, size = 4) + scale_shape_manual( values=c(78, 16, 80)) +
geom_rug(data = HighValues, aes(NewRatio), sides = 'r', size = 1.2) + 
geom_errorbarh(aes(xmin = Ratio.lowerbound, xmax = Ratio.upperbound, height = 0)) +
scale_x_log10(limits = c(0.01, 105), breaks = c(0.01, 0.1, 1, 10, 100), labels = c("0.01", "0.1", "1", "10", "100")) + theme_fivethirtyeight() +
theme(axis.text.y = element_text(hjust = .5))
centerFigure 
centerFigure <- ggplot(data, aes(NewRatio, reorder(Generic.Name, -1*RatioForSort), shape = Type, color = OnPatent)) + 
geom_point(alpha = 0.99, size = 4) + scale_shape_manual( values=c(78, 16, 80)) +
geom_rug(data = HighValues, aes(NewRatio), sides = 'r', size = 1.2) + 
geom_errorbarh(aes(xmin = Ratio.lowerbound, xmax = Ratio.upperbound, height = 0)) +
scale_x_log10(limits = c(0.01, 105), breaks = c(0.01, 0.1, 1, 10, 100), labels = c("0.01", "0.1", "1", "10", "100")) + theme_fivethirtyeight() +
theme(axis.text.y = element_text(hjust = .5)) + scale_color_manual("black", "red")
centerFigure 
centerFigure <- ggplot(data, aes(NewRatio, reorder(Generic.Name, -1*RatioForSort), shape = Type, color = OnPatent)) + 
geom_point(alpha = 0.99, size = 4) + scale_shape_manual( values=c(78, 16, 80)) +
geom_rug(data = HighValues, aes(NewRatio), sides = 'r', size = 1.2) + 
geom_errorbarh(aes(xmin = Ratio.lowerbound, xmax = Ratio.upperbound, height = 0)) +
scale_x_log10(limits = c(0.01, 105), breaks = c(0.01, 0.1, 1, 10, 100), labels = c("0.01", "0.1", "1", "10", "100")) + theme_fivethirtyeight() +
theme(axis.text.y = element_text(hjust = .5)) + scale_color_manual(values = c("black", "red"))
centerFigure 
Year <- ggplot(data, aes(reorder(Brand.Name, -1*RatioForSort),date), fill  = OnPatent) + theme_fivethirtyeight() + 
scale_y_date( limits = c(0, 5000), breaks = c(0, 2500, 5000), labels = c("0", "2.5k", "5k")) +
geom_point(stat = "identity") + coord_flip() + labs( x = "FDA Approval") + theme(axis.text.y = element_text(hjust = .5)) + 
scale_fill_manual(values = c("black", "red"))
Year <- ggplot(data, aes(reorder(Brand.Name, -1*RatioForSort),as.Date(date)), fill  = OnPatent) + theme_fivethirtyeight() + 
scale_y_date( limits = c(0, 5000), breaks = c(0, 2500, 5000), labels = c("0", "2.5k", "5k")) +
geom_point(stat = "identity") + coord_flip() + labs( x = "FDA Approval") + theme(axis.text.y = element_text(hjust = .5)) + 
scale_fill_manual(values = c("black", "red"))
Year 
Year <- ggplot(data, aes(reorder(Brand.Name, -1*RatioForSort),as.Date(date)), fill  = OnPatent) + theme_fivethirtyeight() + 
#scale_y_date( limits = c(0, 5000), breaks = c(0, 2500, 5000), labels = c("0", "2.5k", "5k")) +
geom_point(stat = "identity") + coord_flip() + labs( x = "FDA Approval") + theme(axis.text.y = element_text(hjust = .5)) + 
scale_fill_manual(values = c("black", "red"))
Year 
ggarrange(Year,centerFigure,Frequency, nrow = 3, width = c(0.5, 3, 0.5)
)
grid.arrange(Year,centerFigure,Frequency, nrow = 3, width = c(0.5, 3, 0.5))
library(egg)
grid.arrange(Year,centerFigure,Frequency, nrow = 3, width = c(0.5, 3, 0.5))
Frequency <- ggplot(data, aes(reorder(Brand.Name, -1*RatioForSort),Total.Count/3), fill  = OnPatent) + theme_fivethirtyeight() + 
scale_y_continuous( limits = c(0, 5000), breaks = c(0, 2500, 5000), labels = c("0", "2.5k", "5k")) +
geom_bar(stat = "identity") + coord_flip() + labs( x = "Number of Pages") + theme(axis.text.y = element_text(hjust = .5)) + 
scale_fill_manual(values = c("black", "red"))
Frequency 
grid.arrange(Year,centerFigure,Frequency, nrow = 3, width = c(0.5, 3, 0.5))
Frequency
grid.arrange(Year,centerFigure, nrow = 1, width = c(3, 0.5))
centerFigure <- ggplot(data, aes(NewRatio, reorder(Generic.Name, -1*RatioForSort), shape = Type, color = OnPatent)) + 
geom_point(alpha = 0.99, size = 4) + scale_shape_manual( values=c(78, 16, 80)) +
geom_rug(data = HighValues, aes(NewRatio), sides = 'r', size = 1.2) + 
geom_errorbarh(aes(xmin = Ratio.lowerbound, xmax = Ratio.upperbound, height = 0)) +
scale_x_log10(limits = c(0.01, 105), breaks = c(0.01, 0.1, 1, 10, 100), labels = c("0.01", "0.1", "1", "10", "100")) + theme_fivethirtyeight() +
theme(axis.text.y = element_text(hjust = .5)) + scale_color_manual(values = c("black", "red"))
centerFigure 
Frequency <- ggplot(data, aes(reorder(Brand.Name, -1*RatioForSort),Total.Count/3), fill  = OnPatent) + theme_fivethirtyeight() + 
scale_y_continuous( limits = c(0, 5000), breaks = c(0, 2500, 5000), labels = c("0", "2.5k", "5k")) +
geom_bar(stat = "identity") + coord_flip() + labs( x = "Number of Pages") + theme(axis.text.y = element_text(hjust = .5)) + 
scale_fill_manual(values = c("black", "red"))
Frequency 
Year <- ggplot(data, aes(reorder(Brand.Name, -1*RatioForSort),as.Date(date)), color  = OnPatent) + theme_fivethirtyeight() + 
geom_point(stat = "identity") + coord_flip() + labs( x = "FDA Approval") + theme(axis.text.y = element_text(hjust = .5)) + 
scale_fill_manual(values = c("black", "red"))
Year 
Year <- ggplot(data, aes(reorder(Brand.Name, -1*RatioForSort),as.Date(date)), color  = OnPatent) + theme_fivethirtyeight() + 
geom_point(stat = "identity") + coord_flip() + labs( x = "FDA Approval") + theme(axis.text.y = element_text(hjust = .5)) + 
scale_color_manual(values = c("black", "red"))
Year 
Year <- ggplot(data, aes(reorder(Brand.Name, -1*RatioForSort),as.Date(date),color  = OnPatent)) + theme_fivethirtyeight() + 
geom_point(stat = "identity") + coord_flip() + labs( x = "FDA Approval") + theme(axis.text.y = element_text(hjust = .5)) + 
scale_color_manual(values = c("black", "red"))
Year 
Frequency <- ggplot(data, aes(reorder(Brand.Name, -1*RatioForSort),Total.Count/3,fill  = OnPatent)) + theme_fivethirtyeight() + 
scale_y_continuous( limits = c(0, 5000), breaks = c(0, 2500, 5000), labels = c("0", "2.5k", "5k")) +
geom_bar(stat = "identity") + coord_flip() + labs( x = "Number of Pages") + theme(axis.text.y = element_text(hjust = .5)) + 
scale_fill_manual(values = c("black", "red"))
Frequency 
grid.arrange(Year,centerFigure, nrow = 1, width = c(3, 0.5))
grid.arrange(centerFigure, nrow = 1, width = c(3, 0.5))
centerFigure <- ggplot(data, aes(NewRatio, reorder(Generic.Name, -1*RatioForSort), shape = Type, color = OnPatent)) + 
geom_point(alpha = 0.99, size = 4) + scale_shape_manual( values=c(78, 16, 80)) +
geom_rug(data = HighValues, aes(NewRatio), sides = 'r', size = 1.2) + 
geom_errorbarh(aes(xmin = Ratio.lowerbound, xmax = Ratio.upperbound, height = 0)) +
scale_x_log10(limits = c(0.01, 105), breaks = c(0.01, 0.1, 1, 10, 100), labels = c("0.01", "0.1", "1", "10", "100")) + theme_fivethirtyeight() +
theme(axis.text.y = element_text(hjust = .5)) + scale_color_manual(values = c("black", "red"))
grid.arrange(centerFigure, nrow = 1, width = c(3, 0.5), top =" ")
grid.arrange(Frequency , centerFigure, nrow = 1, width = c(3, 0.5), top =" ")
ggarrange(Frequency , centerFigure, nrow = 1, width = c(3, 0.5), top =" ")
ggarrange(Frequency , centerFigure, nrow = 1, width = c(3, 0.5))
ggarrange(Frequency , centerFigure)
ggarrange(Year, centerFigure, Frequency, nrow = 1,widths = c(0.5, 3, 0.5))
ggsave("Demo1-ThreePartFigure.png")
q()
